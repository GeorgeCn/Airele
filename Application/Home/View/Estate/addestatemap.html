<html>
<head>
	<meta charset="utf-8">
	<title>小区映射关系维护</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"><!-- 最新版本渲染 -->
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/audit_rent_orders.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/basic.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/common.css">
</head>
<body>
   
	<div class="main">

		<div class="main_right">
			<div class="common_main">
				<form method="post" action="__URL__/saveEstatemapAdd">
				<table class="table_one table_two" style="width:100%">
					<input type="hidden" name="estate_id">
					<input type="hidden" name="region_id">
					<input type="hidden" name="scope_id">
					<input type="hidden" name="region_name">
					<input type="hidden" name="scope_name">
					<tr>
						<td class="td_title"><span>*</span>第三方：</td>
						<td class="td_main">
							<select name="third_name">
								<option value="">请选择</option>
									{$flats}
						
							</select>
						</td>
					</tr>
					<tr>
						<td class="td_title"><span>*</span>第三方小区名称：</td>
						<td class="td_main">
							<input type="text" name="estate_name_third"  style="width:99%;">
						</td>
					</tr>
					<tr>
						<td class="td_title"><span>*</span>我们的小区名称：</td>
						<td class="td_main">
							<input type="text"  name="estate_name" class="plotIpt" style="width:99%;">
							<div id="estate_div" class="plotbox" style="width:99%;">
								<ul>
								</ul>
							</div>
						</td>
					</tr>
				</table>
				</form>
				<div class="addhouse_next"><button class="btn_a" id="btn_submit">提交</button>&nbsp;</div>
				 
			</div>
		</div>
</body>
<script src="__PUBLIC__/js/jquery.js"></script>
<script src="__PUBLIC__/js/common.js"></script>
<script src="__PUBLIC__/js/jquery.form.js"></script>
<script type="text/javascript">

$(document).ready(function(){
	var last;
	$("input[name='estate_name']").keyup(function(event){
		//利用event的timeStamp来标记时间，这样每次的keyup事件都会修改last的值，注意last必需为全局变量
		last = event.timeStamp;
		setTimeout(function(){    
			//如果时间差为0（也就是你停止输入0.5s之内都没有其它的keyup事件发生）则做你想要做的事
			if(last-event.timeStamp==0){
				var key_word=$("input[name='estate_name']").val();
				if(key_word.length<1){
					return;
				}
				/*检索小区*/
	           $.get("__ROOT__/HouseResource/searchestate",{keyword:key_word,type:''},function(result){
	           	console.log(key_word);
	           	if(result.status=="200"){
	           		var attr=result.data;
	           		var len=attr.length;
	           		var obj=$("#estate_div ul");
	           		obj.html("");
	           		for (var i = len-1; i >= 0; i--) {
	           			obj.append("<li onclick=\"selectEstate('"+attr[i].id+"','"+attr[i].estate_name+"','"+attr[i].region+"','"+attr[i].scope+"','"+attr[i].region_name+"','"+attr[i].scope_name+"')\" >"+attr[i].estate_name+"--"+attr[i].estate_address+"--"+attr[i].business_typename+"--"+attr[i].region_name+"-"+attr[i].scope_name+"</li>");
	           		};
	           		if(len>0){
	           			$("#estate_div").show();
	           		}else{
	           			$("#estate_div").hide();
	           		}
	           	}
	           },"json");             
	        }
		},500);
	});
});
	

	/*选择小区*/
	function selectEstate(estate_id,estate_name,region,scope,regionName,scopeName){
		$("input[name='estate_id']").val(estate_id);
		$("input[name='estate_name']").val(estate_name);
		$("input[name='region_id']").val(region);
		$("input[name='scope_id']").val(scope);
		$("input[name='region_name']").val(regionName);
		$("input[name='scope_name']").val(scopeName);
		$("#estate_div").hide();
	}
	$("#btn_submit").click(function () {
		if($("select[name='third_name']").val()==""){
			alert("请选择第三方名称");return;
		}
		if($("input[name='estate_name_third']").val()==""){
			alert("请填写第三方小区");return;
		}
		var estateId=$("input[name='estate_id']").val();
		var estateName=$("input[name='estate_name']").val();
		if(estateId=="" || estateName==""){
			alert("请匹配一个我们的小区");return;
		}
		$(this).unbind('click').text("提交中");
		$("form").submit();
	});
	
</script>
</html>
