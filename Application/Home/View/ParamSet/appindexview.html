<html>
<head>
	<meta charset="utf-8">
	<title>APP首页参数管理</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"><!-- 最新版本渲染 -->
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/basic.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/common.css">
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/css/parameter_management_house.css">

</head>
<body>
<include file="Public/head_city" />
      <div class="title cf">
    	<div class="logo fl cf">
			<img src="__PUBLIC__/images/logo.png">
		</div>
		<ul class="cf fl">
		<li><a href="{:U('Welcome/welcome')}">首页</a></li>
			{$menutophtml}
		</ul>
		<div class="cf fr title_right">
			<a class="blue" href="javascript:">欢迎您 <?php echo getLoginName();?></a>
			<span>|</span>
			<a href="{:U('/Index/outlogin')}">退出</a>
		</div>
    </div>
	<div class="main">
		<div class="main_left subNavBox">
		<include file="Public/left_menu" />
			{$menulefthtml}
		</div>
		<div class="main_right">
			<div class="common_head">
				<h2>首页入口</h2>
					<form action="__URL__/appindexview.html" method="get">
				   <input type="hidden" name="no" value="1">
				    <input type="hidden" name="leftno" value="86">
						<table class="table_one" style="margin-top:0px">
						<tr>
							<td class="td_title">版本：</td>
							<td class="td_main">
								<select name="ver_no">
								 <option value="">全部</option>
								  <volist name="curverarr" id="vo">
								     <option value="{$vo['curver']}" <?php if($_GET['ver_no']==$vo['curver']){echo "selected";}?>>{$vo['curver']}</option>
								 </volist>
								</select>&nbsp;&nbsp;&nbsp;
								
							</td>
							<td class="td_title">入口名：</td>
							<td class="td_main"><input name="name" value="<?php echo I('get.name');?>"></td>
						</tr>
					</table>
					<p class="head_p"><button class="btn_a">搜索</button></p>
					 </form>
				</div>
				<div class="common_main">
					<h2>首页入口列表 <a href="__URL__/addtemp.html?no=1&leftno=86" class="btn_a">新增入口</a></h2>
				<div class="table">
					<table>
						<thead>
							<tr>
								<th>入口名</th>
								<th>图标</th>
								<th>排序</th>
								<th>显示/隐藏</th>
								<th>跳转地址</th>
								<th>模块</th><th>版本号</th>
								<th>操作</th>
							</tr>
						</thead>
						<tbody>
						<volist name="list" id="vo">
							<tr>
								<td>{$vo['module_name']}</td>
								<td><img style="width:100px;heigth:40px;" src="{$vo['img_url']}"></td>
								<td>{$vo['sort_index']}</td>
								<td><eq name="vo['is_display']" value="1">显示<else/>隐藏</eq></td>
								<td><a href="{$vo['module_url']}" target="_blank">{$vo['module_url']}</a></td>
								<td><switch name="vo.mid"><case value="1">合租</case><case value="1">合租</case><case value="2">整租</case><case value="3">付房租</case><case value="4">服务</case><case value="5">发房</case><case value="6">看房日程</case><case value="7">收藏</case><case value="8">在线签约</case><case value="8">在线签约</case><case value="9">房东推荐</case><case value="10">公寓</case><case value="999">首页广告</case></switch></td><td>{$vo['ver_no']}</td>
								<td><a href="javascript:;" onclick="if(confirm('确定要删除吗？')){deletedata({$vo['id']});}">删除</a>&nbsp;&nbsp;<a href="__URL__/updatetemp.html?id={$vo['id']}no=1&leftno=86">修改</a></td>
							</tr>
						</volist>
						</tbody>
					</table>
				
				</div>
			</div>
			</div>
			
		</div>
	</div>
 <script src="__PUBLIC__/js/jquery.js"></script>
 <script src="__PUBLIC__/js/common.js"></script>
 <script src="__PUBLIC__/js/jquery.form.js"></script>
<script type="text/javascript">
	$("#fileupload").change(function(){
		$("#submitForm").ajaxSubmit({
			dataType:  'json',
			data:{submitType:'upload'},
			beforeSend: function() {
    		},
    		uploadProgress: function(event, position, total, percentComplete) {
    		},
			success: function(result) {
				//console.log(result);
				$("#imglist").append('<li><img style="dispaly:inline-block;" src="'+result.data.imgUrl+'"><input type="hidden" name="bright" value="'+result.data.imgUrl+'" /></li>');
				$("#fileupload").val('');
				$("input[name='img_url']").val(result.data.imgUrl);
			},
			error:function(xhr){
				alert(xhr.responseText);
			}
		});
	});
	$(".btn_a").bind("click",function(){
		submitdata();
	});
	function submitdata(){
		var info=$("input[name='module_name']").val().replace(/\s+/g,'');
		if(info==""){
			alert("入口名必填项");return;
		}
		info=$("input[name='img_url']").val();
		if(info==""){
			alert("图标必填项");return;
		}
		info=$("input[name='sort_index']").val();
		if(info==""){
			alert("排序必填项");return;
		}
		if($("#ver_no").val()==""){
			alert("版本号必填项");return;
		}
		var regNum=/^\d{1,3}$/;
		if(!regNum.test(info)){
			alert("排序填写有误");return;
		}
		$(".btn_a").unbind("click").text("提交中");
		$("form").submit();
	}
	function deletedata(pid){
		$.post('__URL__/removeAppindex',{pid:pid},function(data){
			if(data.status!="200"){
				alert(data.msg);
			}window.location.reload();
		},'json');
	}
	function editdata(pid,name,img_url,sort,isshow,url,mid,ver_no){
		$("input[name='pid']").val(pid);
		$("input[name='module_name']").val(name);
		$("input[name='module_url']").val(url);
		$("input[name='img_url']").val(img_url);
		$("input[name='sort_index']").val(sort);
		$("input[name='is_display'][value="+isshow+"]").attr("checked","checked");
		$("#mid").val(mid);
		$("#ver_no").val(ver_no);
	}
</script>
</body>
</html>
